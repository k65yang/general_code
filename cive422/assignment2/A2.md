# Question 4

## Part b)
Figures showing the displacement and strain using 4 quadatic elements is shown below.  

![](https://lh3.googleusercontent.com/a2kFl6xA4rr25PF3457lAP2cWVrueEcfJM7tzU3hqu7fY7E3Nz-PvmN8I_pK6QwL1MqJfionwyFw4YZERb6myJzLMkWDmePd1J5FTHClgL17yuq66BlSKpU6Ancdd4YnLzH8R01vCoFsQSs3Fk5ubYVgzxkGgchtpxyvqcjXQBvNiaD1XNapd6laZulT3_CnQMuumXS17MCh62wT1WyS0DeUgQpl_9dLU5EumkIYZzj29EiM-Mk5auw8JsNW9y8OIK7dpIinGHrhFceFH_GxBrFMoGkHL-T-qfAMGd5kW5Rjmmbq7ub7QENpSlFeWpiu6DZeqfha7qOfR-5W8DqLvd5DYXEbqBv-pYgI3SAceeBjXhJt3li9PdwilBAxn7JJF_FWrFO57GsF5r9VbWJLnHUo8jrcQFBpirEH3D6-ELZNv3WeOVIyBeEdg2kQVdtd1PVC0IvBhhcvK-cyfqV6BJZ4aF6yHoAClvBNx1ceOz16jT0bVNHVVJZmnwn7lIMZomMGHl_Akh_KI48WQC4nalWCclJR68UAhFovvbJjcG2rA99FF72ZiATMTRWwl2c87P9HRPcqLWndln4r50ENfI1CoOpO7GVMVbcRqQyPGrQwYS3w5guCoDi89pka1Dytf46jkJoWKEOVMSKwjPW01pcJg6C6fT_0yii6pgYx5Ca2Br1xFt1pXQ=w560-h420-no)  

![](https://lh3.googleusercontent.com/LqbxWhkxiR85uo7shFduoMb7Edu8UgFbMP1CAwYH5BYztFr8oa0ZPvq4PwhVk1TuW5bKBHVJxzQe_o592KbRcUiVlGy_L4p2FMF9DYhscWpqPEn64G6JKNe20e_ZX3KUC8493BUTsdR28R7ATnfYpyPBwhfxDAaGK8sUVJNj1vD5Sc4LguvNKHCYwjgjRE9jcXRGGh_F3zcZ_g9UWf5Hj6E6lY6OEs7Czk06TrYFpzzpmff881rps6gf1LSaNJm-VFsLCxxrDzdLnvpyXkHAvaVKkyiEp01RxRwxtvM3B8CPnTRXIUPev9kRVyy47eU3IfCNTIKRjcvsAULhTJRwWgqxfmYEJBT1ERon45uxnPtRBDBCTNHpRyb-8Ta_-GtCLR34OpxXXVtv2QVmznayRZqxJv9kSwOtXoedUu84njAjpZnSEuO_1RmjUdI3jzyDRljf9lUPyMpvsjQpogVuTGqDDvjBJn3IKYLCbEuQcMs1X0GG_9thR9DHh-GvnUr4heDKaSAge9h0ktcFEcORKsCu-n7M3HrTtTnnJyOBc4dH8qNvNpez4VKyDG0LOwtsdn6PKydyVYg4SUPYhylXXQbVXewWOW7icV-UyrtNhxAVfG6_EtAYIxvGyL616QBeuNWkaNrX_KvNL13H7aBtqXByOgO2PV8YWMZbbmxIFDgI64xOU0K0wQ=w560-h420-no)  

Figures showing the displacement and strain using 8 quadatic elements is shown below.  

![](https://lh3.googleusercontent.com/u5gJXM1X7ZatuG8nKeS_LDdjP74yOz7-wS1iVsOoIo1uxwrS1d6XWnan_X_d9ZpF2H6f3eYUooUAHhgb94WdK-c4DBYrR4NB8it1MkP3CSX9XtzXpa8_q_Ruo3L8BE2act7_YmoOKdYwquqEV4P_vNflyPCn-FHZYXhoFtGyrZOCXENUaoh8Dp4H37JluzBn-Iay_jYmnvNDnHw_6kDsx9-Jn2nKrdta7jMA8Ocs0Wci6hbnmOjFRB5BGP-edJ9NCWOkBSFbEZ7fuMWHoEB8GHt1uYeTacwy9xB7zf0AcwPtJ3XMi78xdx2gNz-jCnjZt5g08-fyxvjXXpm22FqOAM_ue4rL4PiLNbA1-CbPpgYnX81bzzK5chZMWCae-R4ttfyu3PdvSzuDsGMN0XTn28Wtiq8-n0J76oiu4lgfJ2YOYg0XRNPWsGAUf4_4KGyMWfYZ3T1OINzIPfQfkvJrLnD8t7qYLnSVVx89BzhEdz44M_VXx3fAFPU0drDPenkr_HOfKvOnRN1s8HRBTVnBIScybOaQCnXqqrP4cRb8ppMFGUVw8ILhVG6xYihJhPAwRKj4_HfN--vCTRYq7pGb-cjrfS1dbHuD-PtFfxESlZaOm8B8-dGfxdCVAB4cl22RMTQ9_usDj6nv3h8US6nLz0Q5NgvBRDmfwscPYC7tSm9ik6D3mLvZVg=w560-h420-no)  

![](https://lh3.googleusercontent.com/rTY4NJ1R67Amo2dqG72EcQlKzL-0p82gwppBB7UJX7aKI6cpJxPHWNJnXTPbL9wkQEnoesQgioCL-LExICBQUQnF-yTDEC_RQcjX72Yby_mXrxXzTwC_LjHKZfcJiTw7YezOFDgaaOmMq4iRlOpJE7-5-quBr6xWQtxIsXZ6jO-L2JED3MQzha-S2NWIhk0tRo0AB80ZjuiDPEL79tvzilpMWpz0lErXmOhVvVISnL8LDR4UPg6jNSrrFWTN8Xu_m3hpNGSZZlHzABftJNm8YFy8lMI9fGHJeK25MFIVFkbM5p7-Uqowt-s9vgb3Z1QYvZiy56bVkKUUReA83XzX2XPZsGd05jd_ztt3wQk03W2and3YNfxlwqG5myL_xRaSi07FYVUzExIAgbRQkzMctf_Z9qs2aLv3rNtNc3mzSDVGPBcNxA8Q7omWPO1L2CHIuf-HoIniOUpTZrTR8tvzDN2DDt-aUf3J3bSEO4K0kd3_hdDjT2vCav4EVMLj7hrxnKw9qRYDMZqQ2l2RIjuJcj-p95Y7X8iKfsqLPjxYi1tZLjqvnULW6y_TEB3mL9ytW9JNJXzpLqmA6VNecJP4hHMsN2lDxqfnGWvKfJmUICDn9xZMkTXVH2V-iKejDr1iMfdg4n5E4jvZ3xyVOE6KcR5Is0s8SG9KIUf2g-IEDXDLw3q8wCyd7w=w560-h420-no)  

The modified code to compute strain using quadratic elements is presented as follows.  

### function FEM1D
```matlab
function [ rel_err_u, rel_err_e ] = FEM1D( ne )
%% Define Geometry
L = 1;          % length of the domain

%% Define output flags
graphics =1;    % flag set to 1 if graphic output is desired

%% define mesh 
nn = 2*ne+1;      % number of nodes
dL = L/ne;      % element length
dn = dL/2;      % distance between nodes
nodes = 0:dn:L;         

% element connectivity
conn = zeros(ne,3);     
n = 1;
for e=1:ne
   conn(e,1) = n;
   conn(e,2) = n+1;
   conn(e,3) = n+2;
   n = n+2;
end
conn

%% initialize global matrices
K = sparse(nn,nn); % stiffness matrix
F = zeros(nn,1);   % force matrix
d = zeros(nn,1);    % nodal displacements


% build stiffness matrix and force vector
for e=1:ne 
    enodes=conn(e,:); % scatter vector (element nodes)
    x1 = nodes(enodes(1)); % coordinate of node 1
    x2 = nodes(enodes(2)); % coordinate of node 2
    x3 = nodes(enodes(3)); % coordinate of node 3
    b1 = BodyForceAt(x1);     % body force at node 1
    b2 = BodyForceAt(x2);     % body force at node 2
    b3 = BodyForceAt(x3);     % body force at node 3
    
    Ke = 1/12/dn*[14 -16 2;
                  -16 32 -16;
                  2 -16 14];  % element stiffness matrix
    
    Me = dL/30*[4 2 -1;
                2 16 2;
                -1 2 4];

    fe = Me*[b1; b2; b3];       % element nodal force vector 
    
    % Assemble element matrix and vector into global stiffness matrix and force vector
    K(enodes,enodes)=K(enodes,enodes)+Ke;
    F(enodes) = F(enodes)+fe;
end


%% apply traction bc's
 t = dudx(L);
 F(nn) = F(nn)+t;
 
% applied essential bc's
free_dofs = 2:nn;
fixed_dofs = 1;
d(fixed_dofs) = 2;

%% solve linear system of equations
KFF= K(free_dofs,free_dofs);
KFE= K(free_dofs,fixed_dofs);
fE = F(free_dofs);
dE = d(fixed_dofs);

d(free_dofs) = KFF\(fE-KFE*dE)


%% compute error in displacements at x=L
uh = d(nn);
u_ex = u(L);
rel_err_u = abs( (uh-u_ex)/u_ex );

%% compute error in the strain at x=1
strain_h = FEstrain(1,nodes,conn,d,L);
strain_ex = dudx(1);
rel_err_e = abs( ( strain_h-strain_ex )/strain_ex);



if graphics
    % array of equally spaced points between 0 and L where the exact and 
    % FEM solutions will be plotted.
    X=0:L/500:L;  
    % evaluate the exact solution at every point in array X.
    uexact = u(X);   
    % evaluate the FEM solution at every point in array X.
    uFE = FEdisp(X,nodes,conn,d,L) ; 
    % evaluate the gradient(strain) of the exact solution at every point 
    % in array X
    du_exact = dudx(X); 
    % evaluate the gradient(strain) of the FEM solution at every point
    % in array X
    dudxFE = FEstrain(X,nodes,conn,d,L);
    
    %plot results
 
    figure(1);
    plot(X,uexact,'-.b','linewidth',2);
    hold on;
    plot(X,uFE,'r');
    ylabel('{\fontsize{24}dislplacement}','linewidth',2);
    % legend ("EXACT","FEM");% uncomment if you use windows
    legend ('EXACT','FEM');% uncomment if you use mac
    % plot(nodes,d,'ro');
    print -depsc Disp.eps
    hold off;
    
    figure(2);
    plot(X,du_exact,'-.b','linewidth',2);   
    hold on;
    plot(X,dudxFE,'r','linewidth',2);
    ylabel('{\fontsize{24}strain}');    
    %legend("EXACT","FEM");% uncomment if you use windows
    legend('EXACT','FEM');% uncomment if you use windows
    print -depsc Strain.eps
    hold off;
end
```

### function FEdisp
```matlab
function uFE = FEdisp(X,nodes,conn,d,L)

% determines the FE displacement at each point in array X
nx = length(X);
nn = size(nodes,2); % number of nodes in the mesh
ne = (nn-1)/2;  % number of elements
dL = L/ne; % element length
dn = dL/2; % half of element size because quadratic
uFE = zeros(nx,1); % array where FE displacements at each point in X will be stored

% determin shape functions wrt to x
N1e = @(x_,x2,x3) 1/2/dn^2 * (x_-x2)*(x_-x3);
N2e = @(x_,x1,x3) -1/dn^2 * (x_-x1)*(x_-x3);
N3e = @(x_,x1,x2) 1/2/dn^2 * (x_-x1)*(x_-x2);

for ii = 1:nx
    x_val = X(ii);
    elnum = max(1,ceil(x_val/(dL)));
    nLocal = conn(elnum,:);
    x1e = nodes(nLocal(1));
    x2e = nodes(nLocal(2));
    x3e = nodes(nLocal(3));
    
    % Compute shape function at x(ii)
    u = [N1e(x_val,x2e,x3e) N2e(x_val,x1e,x3e) N3e(x_val,x1e,x2e)];
    de = d(nLocal);
    uFE(ii) = u*de;
end
```

### function FEstrain
```matlab
function gradu = FEstrain(x,nodes,conn,d,L)
% determines the FE strain at x
nx = length(x);
nn = size(nodes,2);
dn = L/(nn-1) % distance between nodes
gradu = zeros(nx,1);

% determine the derivatives of shape functions wrt x
B1e = @(x_,e) 1/2/dn^2 * (2*x_ - 3*dn - 4*(e-1)*dn);
B2e = @(x_,e) -1/dn^2 * (2*x_ - 2*dn - 4*(e-1)*dn);
B3e = @(x_,e) 1/2/dn^2 * (2*x_ - dn - 4*(e-1)*dn);

for ii  = 1:nx
    x_val = x(ii);
    elnum = max(1,ceil(x_val/(dn*2)));
    % Compute derivative at x(ii)
    dNdz = [B1e(x_val,elnum) B2e(x_val,elnum) B3e(x_val,elnum)];
    de = d(conn(elnum,:));
    gradu(ii) = dNdz*de;
end
```
